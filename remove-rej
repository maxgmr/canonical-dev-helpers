#!/usr/bin/env bash

tab=$'\t'

dir=""
force=false
help=false

# Check params
for arg in "$@"; do
    case "$arg" in
    -f)
        force=true
        ;;
    -h)
        help=true
        ;;
    *)
        if [[ -z "$dir" ]]; then
            dir="$arg"
        else
            echo "Error: Multiple directories provided."
            exit 1
        fi
        ;;
    esac
done

# Ensure a directory is provided and exists
if [[ -z "$dir" ]]; then
    help=true
elif [[ ! -d "$dir" ]]; then
    echo "Error: Directory '$dir' does not exist."
    exit 1
fi

# Remove all ".rej" files generated by Quilt in the given directory (recursive)
if [[ "$help" == true ]]; then
    echo 'Remove all ".rej" files recursively starting from the given directory.'
    echo ""
    echo "Usage: remove-rej [-f] [directory]"
    echo "${tab}-f: Delete all .rej files without interactive confirmation prompt."
elif [[ "$force" == true ]]; then
    # Force-delete
    find "$dir" -type f -name "*.rej" -delete
else
    # Default behaviour: Interactive deletion with confirmation
    find "$dir" -type f -name "*.rej" -exec rm -i {} +
fi
